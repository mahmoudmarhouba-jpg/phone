<div class="h-full bg-gray-100/70 dark:bg-black/50 backdrop-blur-xl text-gray-900 dark:text-white flex flex-col">
    <!-- Header -->
    <div class="p-2 flex justify-between items-center border-b border-gray-300 dark:border-white/10 flex-shrink-0 bg-gray-200/60 dark:bg-gray-900/60 backdrop-blur-lg sticky top-0 z-10 pt-10">
        <button (click)="phoneState.navigateBack()" class="p-2 text-blue-500 dark:text-blue-400">
             <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg>
        </button>
        <div class="text-center flex flex-col items-center">
            <img [src]="contact()?.avatar || 'https://i.pravatar.cc/150?u=' + contact()?.id" class="w-10 h-10 rounded-full" alt="">
            <h1 class="text-md font-bold">{{ contact()?.name }}</h1>
        </div>
        <button (click)="callContact()" class="p-2 text-blue-500 dark:text-blue-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
        </button>
    </div>

    <!-- Message List -->
    <div class="flex-grow p-4 space-y-2 overflow-y-auto">
        @for(message of chatMessages(); track message.id) {
            <div class="flex" [class.justify-end]="message.isSender">
                <div 
                    class="max-w-[75%] p-3 rounded-3xl"
                    [class.text-white]="message.isSender"
                    [class.bg-gradient-to-br]="message.isSender"
                    [class.from-blue-500]="message.isSender"
                    [class.to-blue-600]="message.isSender"
                    [class.rounded-br-md]="message.isSender"
                    [class.bg-gray-200]="!message.isSender"
                    [class.dark:bg-gray-700]="!message.isSender"
                    [class.rounded-bl-md]="!message.isSender"
                >
                    <p class="text-base">{{ message.text }}</p>
                </div>
            </div>
        }
    </div>

    <!-- Input Box -->
    <div class="p-2 border-t border-gray-300 dark:border-white/10 flex-shrink-0 bg-gray-100/30 dark:bg-black/30 backdrop-blur-lg">
        <div class="flex items-center bg-gray-200/80 dark:bg-gray-700/80 rounded-full px-2 py-1">
            <input 
                type="text"
                [(ngModel)]="newMessage"
                (keydown.enter)="sendMessage()"
                placeholder="Message..."
                class="flex-grow bg-transparent px-3 text-base focus:outline-none"
            >
            <button (click)="sendMessage()" class="p-2 rounded-full bg-blue-500 hover:bg-blue-600 transition-colors disabled:bg-gray-600" [disabled]="!newMessage()">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 10l7-7m0 0l7 7m-7-7v18" /></svg>
            </button>
        </div>
    </div>
</div>
